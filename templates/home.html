{% extends "base2.html" %}
{% block content %}
<body class="home">
<center>
    <div class="dashboard-app">
        <div style="position: absolute; top: 0%; bottom: 0; left: 0%; right: 0;">
            <div>
                <select id="selectUbicaciones" class="custom-select"></select>
                <script>
                    $(document).ready(function(){
                        debugger;
                        var ubicaciones = {{ ubicaciones|tojson }};
                        $('#selectUbicaciones')
                        .append($("<option selected='selected' value='Selecciona un patrimonio para obtener las estadísticas temporales'></option>")
                                   .text("Selecciona un patrimonio para obtener las estadísticas temporales"));
                        $.each(ubicaciones, function(ubicacion) {   
                            $('#selectUbicaciones')
                                .append($("<option></option>")
                                           .attr("value", ubicaciones[ubicacion])
                                           .text(ubicaciones[ubicacion])); 
                       });
                    });
                    $('#selectUbicaciones').on('change', function() {
                        var textoSeleccionado=$("#selectUbicaciones option:selected").val();
                        var hrefredirect=textoSeleccionado.split(" ").join("+");
                        window.location.href = "/estadisticasTemporales/"+ hrefredirect;
                        
                      });
                                 
                </script>
            </div>
        </div>

        </script>
        <div style="position: absolute; top: 10%; bottom: 0; left: 0%; right: 0;">
            <div id="map" style="height: 100%"></div>
            <script type="text/javascript">
                // Crear un mapa y especificar su div contenedor y opciones
                var map = L.map('map', {
                    center: [42.37014,-5.030849],
                    zoom: 8
                });
                // Añadir capas al mapa   
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
                maxZoom: 18
                }).addTo(map);

                var contador={{marcadores}}.length
                var ubicaciones = {{ ubicaciones|tojson }}
                
                for (var i = 0; i < contador; i++) {
                    
                    latitud={{marcadores}}[i][0]
                    longitud={{marcadores}}[i][1]
                    var marker = L.marker([latitud,longitud]).addTo(map)
                    patrimonio = ubicaciones[i].split(" ").join("+");
                    function generateURL(param_value) {
                        const baseURL = '/estadisticasTemporales/';
                        return baseURL + patrimonio;
                    }
                    marker.bindTooltip(ubicaciones[i], {permanent: false});
                    marker.bindPopup('<a href="' + generateURL(patrimonio) + '">' + ubicaciones[i] + '</a>');
                };             
        </script>
        
    </div>  
</center> 
{% endblock %}